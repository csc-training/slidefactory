BootStrap: library
From: ubuntu:20.04

%environment
    export SLIDE_FACTORY_CONTAINER=/slide-factory

%post
    apt update && apt install -y software-properties-common
    apt update && add-apt-repository universe && apt update
    apt install -y python3-pip pandoc python3-pandocfilters
    apt install -y fonts-noto fonts-inconsolata
    apt install -y cabal-install nvi
    cabal update
    mkdir -p /root/.cabal/bin
    cabal install pandoc-types-1.17.5.4
    cabal install pandoc-emphasize-code
    apt-get remove -y --autoremove cabal-install
    apt install -y git
    url=https://github.com/csc-training/slide-template
    git clone $url $SINGULARITY_ROOTFS/slide-factory

%runscript
    if test "$SLIDE_FACTORY" = ""
    then
	    export SLIDE_FACTORY=$SLIDE_FACTORY_CONTAINER
    fi
	exec python3 $SLIDE_FACTORY/convert.py "$@"
